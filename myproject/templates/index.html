{% extends 'base.html' %}

{% block content %}
<section>
    <h2>Bienvenido a mi sitio web sobre Consumo Eléctrico en Chile</h2>
    <p>¡Hola y bienvenido! Estás visitando mi sitio web dedicado a explorar y entender el consumo eléctrico en Chile, un tema fundamental en nuestra sociedad moderna y en la gestión de recursos energéticos.</p>
    <p>Aquí encontrarás información detallada y análisis sobre diversos aspectos del consumo eléctrico en Chile, desde estadísticas actualizadas hasta tendencias históricas y proyecciones futuras.</p>
    <p>Mi objetivo es proporcionarte una plataforma informativa donde puedas:</p>
    <ul>
        <li>Explorar datos actualizados sobre consumo eléctrico por regiones y tipos de usuarios.</li>
        <li>Comprender las tarifas eléctricas y cómo afectan a los consumidores y empresas.</li>
        <li>Visualizar gráficos interactivos que muestran patrones y tendencias clave en el consumo de energía.</li>
        <li>Acceder a recursos útiles y enlaces a sitios web oficiales relacionados con el sector eléctrico en Chile.</li>
    </ul>
    <p>Este sitio no solo busca informar, sino también educar y facilitar el acceso a datos relevantes para estudiantes, profesionales del sector energético y cualquier persona interesada en conocer más sobre cómo se gestiona y utiliza la energía eléctrica en nuestro país.</p>
    <p>¡Espero que encuentres esta información útil y enriquecedora! No dudes en explorar las diversas secciones y compartir tus comentarios y sugerencias para mejorar esta plataforma.</p>
</section>

<section>
    <h2>Tipos de Facturación en Chile sobre Consumo Eléctrico</h2>
    <p>En Chile, los tipos de facturación sobre el consumo eléctrico pueden variar dependiendo del tipo de suministro eléctrico, la distribuidora y el contrato específico. Algunos de los tipos de facturación más comunes incluyen:</p>
    <ul>
        <li>Tarifa BT4 (Baja Tensión 4)</li>
        <li>Tarifa BT5 (Baja Tensión 5)</li>
        <li>Tarifa MT (Media Tensión)</li>
        <li>Tarifa AT (Alta Tensión)</li>
        <li>Tarifa Horaria</li>
        <li>Tarifa Estacional</li>
        <li>Tarifa por Bloques de Consumo</li>
    </ul>
    <p>Es importante tener en cuenta que estas son solo algunas de las tarifas más comunes en Chile y que pueden existir otras variaciones y combinaciones dependiendo de la regulación local y los acuerdos individuales entre los clientes y las distribuidoras eléctricas. Se recomienda consultar con la distribuidora eléctrica local o con un experto en el tema para obtener información específica sobre las tarifas disponibles en tu área.</p>
</section>

<section>
    <h2>Gráficos de Consumo Eléctrico</h2>
    <div class="chart-container">
        <h3>Clientes Facturados por Año</h3>
        <canvas id="grafico1"></canvas>
    </div>
    <div class="chart-container">
        <h3>Consumo de Energía (kWh) por Año</h3>
        <canvas id="grafico2"></canvas>
    </div>
    <div class="chart-container">
        <h3>Energía por Región (kWh)</h3>
        <canvas id="grafico3"></canvas>
    </div>
</section>

<section>
    <img class="responsive-img" src="https://www.enel.cl/content/enel-cl/es/megamenu/clientes/informacion-util/entendiendo-mi-boleta/_jcr_content/article-content/image_1013901209_cop.img.png/1639055418916.png" alt="Imagen de la boleta">
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Función para obtener datos desde el backend
    async function obtenerDatos() {
        const response = await fetch('/api/datos');
        return await response.json();
    }

    // Función para crear gráficos
    async function crearGraficos() {
        const datos = await obtenerDatos();

        // Obtener años únicos presentes en los datos y ordenarlos
        const years = [...new Set(datos.map(d => d.anio))].sort();
        const dataPorAnio = years.map(year => {
            return {
                year: year,
                clientesFacturados: datos
                    .filter(d => d.anio === year)
                    .reduce((total, item) => total + parseInt(item.clientes_facturados), 0),
                energiaKwh: datos
                    .filter(d => d.anio === year)
                    .reduce((total, item) => total + parseFloat(item.energia_kwh), 0)
            };
        });

        const labels = dataPorAnio.map(d => d.year);
        const clientesFacturados = dataPorAnio.map(d => d.clientesFacturados);
        const energiaKwh = dataPorAnio.map(d => d.energiaKwh);

        // Gráfico 1
        const ctx1 = document.getElementById('grafico1').getContext('2d');
        new Chart(ctx1, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Clientes Facturados',
                    data: clientesFacturados,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                }]
            }
        });

        // Gráfico 2
        const ctx2 = document.getElementById('grafico2').getContext('2d');
        new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Energía (kWh)',
                    data: energiaKwh,
                    borderColor: 'rgba(153, 102, 255, 1)',
                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                }]
            }
        });

        // Gráfico 3 (ejemplo de gráfico de torta)
        const regiones = [...new Set(datos.map(d => d.region))];
        const energiaPorRegion = regiones.map(region => {
            return datos
                .filter(d => d.region === region)
                .reduce((total, item) => total + parseFloat(item.energia_kwh), 0);
        });

        const ctx3 = document.getElementById('grafico3').getContext('2d');
        new Chart(ctx3, {
            type: 'pie',
            data: {
                labels: regiones,
                datasets: [{
                    label: 'Energía por Región (kWh)',
                    data: energiaPorRegion,
                    backgroundColor: regiones.map(() => `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.2)`),
                    borderColor: regiones.map(() => `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 1)`),
                }]
            }
        });
    }

    // Crear gráficos al cargar la página
    document.addEventListener('DOMContentLoaded', crearGraficos);
</script>
{% endblock %}
